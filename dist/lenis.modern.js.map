{"version":3,"file":"lenis.modern.js","sources":["../src/lenis.js","../src/maths.js"],"sourcesContent":["import EventEmitter from 'tiny-emitter'\nimport VirtualScroll from 'virtual-scroll'\nimport { clamp, lerp } from './maths.js'\n\nexport default class Lenis extends EventEmitter {\n  constructor({ lerp = 0.1, smooth = true } = {}) {\n    super()\n\n    this.lerp = lerp\n    this.smooth = smooth\n\n    document.addEventListener('wheel', this.onWheel, { passive: false })\n    window.addEventListener('scroll', this.onScroll, false)\n    window.addEventListener('resize', this.onWindowResize, false)\n\n    const platform = navigator?.userAgentData?.platform || navigator?.platform || 'unknown'\n\n    // listen and normalize wheel event cross-browser\n    this.virtualScroll = new VirtualScroll({\n      firefoxMultiplier: 50,\n      mouseMultiplier: platform.indexOf('Win') > -1 ? 1 : 0.4, useKeyboard: false,\n      useTouch: false,\n      passive: true,\n    })\n\n    this.virtualScroll.on(this.onVirtualScroll)\n\n    this.onWindowResize()\n    this.maxScroll = document.body.offsetHeight - this.windowHeight\n\n    // recalculate maxScroll when body height changes\n    this.resizeObserver = new ResizeObserver(this.onResize)\n    this.resizeObserver.observe(document.body)\n\n    this.targetScroll = this.scroll = window.scrollY\n  }\n\n  start() {\n    this.stopped = false\n  }\n\n  stop() {\n    this.stopped = true\n  }\n\n  destroy() {\n    document.removeEventListener('wheel', this.onWheel, { passive: false })\n    window.removeEventListener('scroll', this.onScroll, false)\n    window.removeEventListener('resize', this.onWindowResize, false)\n    this.virtualScroll.destroy()\n    this.resizeObserver.disconnect()\n  }\n\n  onResize = (entries) => {\n    const entry = entries[0]\n    if (entry) {\n      const rect = entry.contentRect\n      this.maxScroll = rect.height - this.windowHeight\n    }\n  }\n\n  onWindowResize = () => {\n    this.windowHeight = window.innerHeight\n    this.windowWidth = window.innerWidth\n  }\n\n  onWheel = (e) => {\n    // prevent native wheel scroll\n    if (this.smooth && !e.ctrlKey) e.preventDefault()\n  }\n\n  onVirtualScroll = ({ deltaY }) => {\n    if (this.stopped) return\n    this.targetScroll -= deltaY\n    this.targetScroll = clamp(0, this.targetScroll, this.maxScroll)\n  }\n\n  raf() {\n    if (!this.smooth || this.stopped) return\n\n    // lerp scroll value\n    this.scroll = lerp(this.scroll, this.targetScroll, this.lerp)\n    if (Math.round(this.scroll) === Math.round(this.targetScroll)) {\n      this.scroll = this.targetScroll\n    }\n\n    if (this.scrolling) {\n      // scroll to lerped scroll value\n      window.scrollTo(0, this.scroll)\n      this.emit('scroll', { scroll: this.scroll })\n    }\n\n    this.scrolling = this.scroll !== this.targetScroll\n  }\n\n  onScroll = (e) => {\n    // if scrolling is false we can estimate you aren't scrolling with wheel (cmd+F, keyboard or whatever). So we must scroll to without any easing\n    if (!this.scrolling || !this.smooth) {\n      this.targetScroll = this.scroll = window.scrollY\n      this.emit('scroll', { scroll: this.scroll })\n    }\n  }\n\n  scrollTo(target, { offset = 0 } = {}) {\n    let y\n\n    if (typeof target === 'number') {\n      // Number\n      y = target\n    } else if (target === '#top') {\n      y = 0\n    } else if (target === '#bottom') {\n      y = this.maxScroll\n    } else {\n      let node\n\n      if (typeof target === 'string') {\n        // CSS selector\n        node = document.querySelector(target)\n      } else if (target?.nodeType) {\n        // Node element\n        node = target\n      } else {\n        return\n      }\n\n      if (!target) return\n      y = node.getBoundingClientRect().top + this.scroll\n    }\n\n    y += offset\n\n    this.targetScroll = y\n    this.scrolling = true\n    if (!this.smooth) {\n      this.scroll = y\n    }\n  }\n}\n","export function clamp(min, input, max) {\n  return input < min ? min : input > max ? max : input\n}\n\nexport function mapRange(in_min, in_max, input, out_min, out_max) {\n  return ((input - in_min) * (out_max - out_min)) / (in_max - in_min) + out_min\n}\n\nexport function lerp(start, end, amt) {\n  return (1 - amt) * start + amt * end\n}\n\nexport function truncate(value, decimals) {\n  return parseFloat(value.toFixed(decimals))\n}\n"],"names":["Lenis","EventEmitter","constructor","lerp","smooth","_navigator","_navigator$userAgentD","_navigator2","super","this","onResize","entries","entry","maxScroll","contentRect","height","windowHeight","onWindowResize","window","innerHeight","windowWidth","innerWidth","onWheel","e","ctrlKey","preventDefault","onVirtualScroll","deltaY","input","max","stopped","targetScroll","onScroll","scrolling","scroll","scrollY","emit","document","addEventListener","passive","platform","navigator","userAgentData","virtualScroll","VirtualScroll","firefoxMultiplier","mouseMultiplier","indexOf","useKeyboard","useTouch","on","body","offsetHeight","resizeObserver","observe","start","stop","destroy","removeEventListener","disconnect","raf","amt","Math","round","scrollTo","target","offset","y","node","querySelector","nodeType","getBoundingClientRect","top"],"mappings":"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"}